package com.stc;



import com.stc.WheeleView.WheeleThread;

import android.app.Activity;
import android.os.Bundle;
import android.view.ContextMenu;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ContextMenu.ContextMenuInfo;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemSelectedListener;
import android.widget.ArrayAdapter;
import android.widget.Spinner;
import android.widget.TextView;
import android.widget.Toast;

// TODO Fix where octave shifts in keys other than C (outside circle)
// TODO Fix issues with sleep on/off (See SpinnerActivity)
// TODO add circle scrolling on all 4 quatrants
// TODO implement other patterns
// TODO Check all scales
// TODO on new scale always start on Ionian
// TODO Fix Landscape view
// TODO Implement About box (and versioning)
 	
/**
 * @author Scott Coleman
 *
 * Main activity
 */
public class ModeWheele extends Activity 
{
    private static final int MENU_TOGGLE_SCALE = Menu.FIRST+100;
    
    
    private WheeleView mWheeleView;
    private StaffView mStaffView;
    private FretboardView mFretboardView;
    private WheeleThread mWheeleThread;
    /**
     * ArrayAdapter connects the spinner widget to array-based data.
     */
    protected ArrayAdapter<CharSequence> mAdapter;
    
    
	
    /* (non-Javadoc)
     * Called when the activity is first created
     * @see android.app.Activity#onCreate(android.os.Bundle)
     */
    @Override
    public void onCreate(Bundle savedInstanceState) 
    {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
        
        mStaffView = (StaffView) findViewById(R.id.staff); 
        mFretboardView = (FretboardView) findViewById(R.id.fretboard); 
        
        mWheeleView = (WheeleView) findViewById(R.id.wheele);   
        mWheeleView.SetStaffView(mStaffView);
        mWheeleView.SetFretboardView(mFretboardView);

  	  	Scale scale = new Scale("Ionian", "C");
  	  	scale.setInitialStringAndFret(6,1); // This also sets octave
  	  	mWheeleView.SetScale(scale);
        
  	  	mWheeleView.setTextView((TextView) findViewById(R.id.TextView01));        
        mWheeleThread = mWheeleView.getThread();   
        mWheeleThread.doStart();
        
        TextView fred = (TextView)findViewById(R.id.TextView01);
        fred.setText("hi there this is a testr");
        registerForContextMenu(mWheeleView);
        
        mFretboardView.setmParentActivity(this);

        
        Spinner spinner = (Spinner) findViewById(R.id.Spinner01);
        ArrayAdapter<CharSequence> adapter = ArrayAdapter.createFromResource(
                this, R.array.ScaleNotes, android.R.layout.simple_spinner_item);
        adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
        spinner.setAdapter(adapter);    
        spinner.setOnItemSelectedListener(new MyOnItemSelectedListener());        
    }    	

    /**
     * Called when another view detects that a new note has been selected
     * 
     * @param noteView - The note that was selected
     */
    public void SelectionChanged(NoteView noteView)
    {
    	mWheeleView.SelectionChanged(noteView);
    }
    
	/* (non-Javadoc)
	 * @see android.app.Activity#onCreateContextMenu(android.view.ContextMenu, android.view.View, android.view.ContextMenu.ContextMenuInfo)
	 */
	@Override
	public void onCreateContextMenu(ContextMenu menu, View v,
			ContextMenuInfo menuInfo)
	{
		super.onCreateContextMenu(menu, v, menuInfo);
		  MenuInflater inflater = getMenuInflater();
		  inflater.inflate(R.menu.options_menu, menu);		
	}



	/* (non-Javadoc)
	 * @see android.app.Activity#onCreateOptionsMenu(android.view.Menu)
	 */
	@Override 
	public boolean onCreateOptionsMenu(Menu menu) {
        getMenuInflater().inflate(R.menu.options_menu, menu);    
        return true;
    }

	/* (non-Javadoc)
	 * @see android.app.Activity#onOptionsItemSelected(android.view.MenuItem)
	 */
	@Override
	public boolean onOptionsItemSelected(MenuItem item)
	{
		  switch (item.getItemId()) 
		  {
			    case R.id.toggleScaleSelector:
			    	Spinner spinner = (Spinner) findViewById(R.id.Spinner01);
			        if (spinner == null) return true;
			    	if (spinner.getVisibility() == View.GONE)
			    		spinner.setVisibility(View.VISIBLE);
			    	else
			    		spinner.setVisibility(View.GONE);
			        return true;
			        
			        
			    default:
			        return super.onOptionsItemSelected(item);		
		
		  }    
	} 
	public class MyOnItemSelectedListener implements OnItemSelectedListener {

	    public void onItemSelected(AdapterView<?> parent, View view, int pos, long id) 
	    {
	    	// Make sure we have initialized wheeleView
	    	if (mWheeleView == null) return;
	    	
	    	String root = parent.getItemAtPosition(pos).toString();
	    	Scale scale = new Scale("Ionian", root);
	  	  	scale.setInitialStringAndFret(6,1); // This also sets octave			        
	        mWheeleView.SetScale(scale);
	        mWheeleView.ResetRotation();
	        mWheeleView.redraw = true;
	        mWheeleView.invalidate();	    	
	    	Toast.makeText(parent.getContext(), "You have chosen scale: " +  root, Toast.LENGTH_LONG).show();
	    }

	    public void onNothingSelected(AdapterView parent) {
	      // Do nothing.
	    }
	}    
}